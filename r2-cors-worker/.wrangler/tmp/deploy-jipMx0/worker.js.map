{
  "version": 3,
  "sources": ["../../../worker.js"],
  "sourceRoot": "/Users/dg/Desktop/Studios-App/Backend/r2-cors-worker/.wrangler/tmp/deploy-jipMx0",
  "sourcesContent": ["// Cloudflare Worker to proxy R2 uploads with proper CORS headers\n\nconst ALLOWED_ORIGINS = [\n  'https://www.studioz.co.il',\n  'https://studioz.co.il',\n  'http://localhost:5173',\n  'https://api.studioz.co.il',\n  'https://www.api.studioz.co.il',\n];\n\nfunction getCorsHeaders(request) {\n  const origin = request.headers.get('Origin');\n  const allowedOrigin = ALLOWED_ORIGINS.includes(origin) ? origin : ALLOWED_ORIGINS[0];\n\n  return {\n    'Access-Control-Allow-Origin': allowedOrigin,\n    'Access-Control-Allow-Methods': 'GET, PUT, HEAD, DELETE, OPTIONS',\n    'Access-Control-Allow-Headers': '*',\n    'Access-Control-Expose-Headers': 'ETag',\n    'Access-Control-Max-Age': '3600',\n  };\n}\n\nexport default {\n  async fetch(request, env) {\n    const corsHeaders = getCorsHeaders(request);\n\n    // Handle preflight OPTIONS request\n    if (request.method === 'OPTIONS') {\n      return new Response(null, {\n        status: 204,\n        headers: corsHeaders,\n      });\n    }\n\n    // Get the target R2 URL from the query parameter\n    const url = new URL(request.url);\n    const targetUrl = url.searchParams.get('url');\n\n    if (!targetUrl) {\n      return new Response('Missing url parameter', {\n        status: 400,\n        headers: corsHeaders,\n      });\n    }\n\n    try {\n      // For presigned URLs, make a clean request - the auth is in the URL\n      const r2Response = await fetch(targetUrl, {\n        method: request.method,\n        body: request.method === 'PUT' || request.method === 'POST' ? request.body : undefined,\n      });\n\n      // Create response with CORS headers\n      const responseHeaders = new Headers(r2Response.headers);\n      Object.entries(corsHeaders).forEach(([key, value]) => {\n        responseHeaders.set(key, value);\n      });\n\n      return new Response(r2Response.body, {\n        status: r2Response.status,\n        statusText: r2Response.statusText,\n        headers: responseHeaders,\n      });\n    } catch (error) {\n      return new Response(`Proxy error: ${error.message}`, {\n        status: 500,\n        headers: corsHeaders,\n      });\n    }\n  },\n};\n"],
  "mappings": ";;;;AAEA,IAAM,kBAAkB;AAAA,EACtB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF;AAEA,SAAS,eAAe,SAAS;AAC/B,QAAM,SAAS,QAAQ,QAAQ,IAAI,QAAQ;AAC3C,QAAM,gBAAgB,gBAAgB,SAAS,MAAM,IAAI,SAAS,gBAAgB,CAAC;AAEnF,SAAO;AAAA,IACL,+BAA+B;AAAA,IAC/B,gCAAgC;AAAA,IAChC,gCAAgC;AAAA,IAChC,iCAAiC;AAAA,IACjC,0BAA0B;AAAA,EAC5B;AACF;AAXS;AAaT,IAAO,iBAAQ;AAAA,EACb,MAAM,MAAM,SAAS,KAAK;AACxB,UAAM,cAAc,eAAe,OAAO;AAG1C,QAAI,QAAQ,WAAW,WAAW;AAChC,aAAO,IAAI,SAAS,MAAM;AAAA,QACxB,QAAQ;AAAA,QACR,SAAS;AAAA,MACX,CAAC;AAAA,IACH;AAGA,UAAM,MAAM,IAAI,IAAI,QAAQ,GAAG;AAC/B,UAAM,YAAY,IAAI,aAAa,IAAI,KAAK;AAE5C,QAAI,CAAC,WAAW;AACd,aAAO,IAAI,SAAS,yBAAyB;AAAA,QAC3C,QAAQ;AAAA,QACR,SAAS;AAAA,MACX,CAAC;AAAA,IACH;AAEA,QAAI;AAEF,YAAM,aAAa,MAAM,MAAM,WAAW;AAAA,QACxC,QAAQ,QAAQ;AAAA,QAChB,MAAM,QAAQ,WAAW,SAAS,QAAQ,WAAW,SAAS,QAAQ,OAAO;AAAA,MAC/E,CAAC;AAGD,YAAM,kBAAkB,IAAI,QAAQ,WAAW,OAAO;AACtD,aAAO,QAAQ,WAAW,EAAE,QAAQ,CAAC,CAAC,KAAK,KAAK,MAAM;AACpD,wBAAgB,IAAI,KAAK,KAAK;AAAA,MAChC,CAAC;AAED,aAAO,IAAI,SAAS,WAAW,MAAM;AAAA,QACnC,QAAQ,WAAW;AAAA,QACnB,YAAY,WAAW;AAAA,QACvB,SAAS;AAAA,MACX,CAAC;AAAA,IACH,SAAS,OAAO;AACd,aAAO,IAAI,SAAS,gBAAgB,MAAM,OAAO,IAAI;AAAA,QACnD,QAAQ;AAAA,QACR,SAAS;AAAA,MACX,CAAC;AAAA,IACH;AAAA,EACF;AACF;",
  "names": []
}
